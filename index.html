// === CONFIG ===
const SHEET_ID = 'PASTE_YOUR_SHEET_ID_HERE';  // l'ID tra /d/ e /edit
const SHEET_NAME = 'Foglio1';                  // il tuo tab si chiama "Foglio1"

// Ping opzionale
function doGet() {
  return ContentService.createTextOutput('OK').setMimeType(ContentService.MimeType.TEXT);
}

// Riceve POST x-www-form-urlencoded con "payload" JSON
function doPost(e) {
  try {
    const data = JSON.parse(e.parameter.payload || '{}');

    const ss = SpreadsheetApp.openById(SHEET_ID);
    const sh = ss.getSheetByName(SHEET_NAME) || ss.getSheets()[0];

    const T = data.trials || {};
    const row = [
      new Date(),                  // Timestamp
      data.N_patient || '',        // N paziente
      data.pre?.age ?? '',         // Age
      data.pre?.nihss ?? '',       // NIHSS
      data.pre?.ltsw ?? '',        // LTSW_h (ore)
      data.pre?.premrs ?? '',      // pre_mRS
      // Trial columns (default "no")
      T.WeTrust ?? 'no',
      T.MARSS ?? 'no',
      T.ATHENA ?? 'no',
      T.VANISH ?? 'no',
      T.PIVOTAL ?? 'no',
      T.MOSTE ?? 'no',
      T.FASTEST ?? 'no',
      T.TICH3 ?? 'no',
      T.LIBREXIA ?? 'no',
      T.TWIN2WIN ?? 'no',
      T.ARTEMIS ?? 'no',
      T.HYBERNIA ?? 'no',
      T.DONESYMPLE ?? 'no'
    ];

    sh.appendRow(row);

    return ContentService
      .createTextOutput(JSON.stringify({ ok: true }))
      .setMimeType(ContentService.MimeType.JSON);

  } catch (err) {
    return ContentService
      .createTextOutput(JSON.stringify({ ok:false, error: String(err) }))
      .setMimeType(ContentService.MimeType.JSON);
  }
}




